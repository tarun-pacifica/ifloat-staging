<%= partial "common/header" %>

<div id="body">

<div id="product_data_panel" class="panel minor">
	<div class="title"> <h2>Common Product Data</h2> </div>
	<%= product_data_panel(@common_values) %>
</div>

<div id="compare_by_class" class="panel major">
	<div class="title">
		<h2><%= panel_title_back_to_find(@find) %></h2>
	</div>
	
	<div class="body">
		<table summary="comparison">
			<tr>
				<td class="count">
					<% if @product_count > @product_ids.size %>
					showing <%= @product_ids.size %>/<%= @product_count %> items
					<% end %>
				</td>
				<% @product_ids.each_with_index do |product_id, i| %>
				<td class="product image"
					onclick="window.location = '<%= url(:product, :id => product_id) %>'"
					onmouseover="util_highlight_column(event, 'on', <%= i + 2 %>)"
					onmouseout="util_highlight_column(event, 'off')">
					<%= product_image(@images_by_product_id[product_id])%>
				</td>
				<% end %>
			</tr>
		
			<% parity = :even %>
			<% @diff_properties.each do |prop_info| %>
			<% property_id = prop_info[:id] %>
			<% infos_by_product_id = @diff_values_by_prop_id[property_id].hash_by { |info| info[:product_id] } %>
			<tr class="<%= parity = (parity == :even ? :odd : :even) %>">
				<td class="icon">
					<%= property_icon(prop_info) if prop_info[:dad] %>
				</td>
				<% @product_ids.each_with_index do |product_id, i| %>
				<td class="product"
					onclick="window.location = '<%= url(:product, :id => product_id) %>'"
					onmouseover="util_highlight_column(event, 'on', <%= i + 2 %>)"
					onmouseout="util_highlight_column(event, 'off')">
					<%= product_value_summary(infos_by_product_id[product_id], :left) %>
				</td>
				<% end %>
			</tr>
			<% end %>
		</table>
	</div>
</div>

</div>

<script type="text/javascript" charset="utf-8">
	$('img.property_icon').unbind('click');
</script>
