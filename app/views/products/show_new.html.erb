<% @async_tracking = true %>
<%= partial "common/header" %>

<div id="product">
  <h1><%= brand_image(@brand) %> <%= @title.superscript %></h1>
  <hr class="terminator" />
  
  <div class="main_info">
    <div class="images">
      <img class="main" src=<%= @image_urls.first.inspect %> alt=<%= @page_title.inspect %> />
      <%= @image_urls.map { |url| "<img class=\"thumb\" src=#{url.inspect} alt=\"thumbnail\" onmouseover=\"product_thumb_hover(event)\" />" } if @image_urls.size > 1 %>
    </div>
    
    <div class="other">
      <div class="info_snippet">
        <h2>Summary</h2>
        <p><%= @summary %></p>
      </div>
      
      <code>
        <%= @sibling_data.inspect %>
      </code>
      <p></p>
      
      <div class="info_snippet" id="show_me_more">
        <h2>Show me more...</h2>
        <p>
          <%= finder_link(@more_class, :text => "#{@more_class} products (#{@more_counts[@more_class]})") %>
          <%= @more_tags.map { |tag| finder_link(tag, :tag => true, :text => "#{tag} (#{@more_counts[tag]})") } %>
        </p>
      </div>
      
      <% unless @product_links_by_rel_name.empty? %>
        <a href="#related_products" id="related_anchor">VIEW RELATED PRODUCTS</a>
      <% end %>
      
      <% unless @related_media.empty? %>
      <div class="info_snippet" id="related_media">
        <h2>Related media...</h2>
        <table class="related_media" summary="related media">
          <% @related_media.each do |name, url, icon_url| %>
          <tr>
            <td class="icon"> <img src=<%= icon_url.inspect %> alt="media icon" /> </td>
            <td> <a href=<%= url.inspect %> target="_blank_"><%= name %></a> </td>
          </tr>
          <% end %>
        </table>
      </div>
      <% end %>
    </div>
    
    <hr class="terminator" />
  </div>
  
  <div class="extended_info">
    <% features, description = @body_values_by_name.values_at("marketing:feature_list", "marketing:description").map { |values| (values || []).first.to_s.superscript } %>
    
    <% unless features.blank? %>
    <div class="info_snippet">
      <h2>Features</h2>
      <ul>
        <% features.split("\n").each do |feature| %>
        <li><%= feature %></li>
        <% end %>
      </ul>
    </div>
    <% end %>
    
    <% unless description.blank? %>
    <div class="info_snippet">
      <h2>Description</h2>
      <%= BlueCloth.new(description).to_html %>
    </div>
    <% end %>
  </div>
  
  <div class="properties">
    <code>
      <%= @property_value_sections.inspect %>
    </code>
    <p></p>
    <code>
      <% @property_values.inspect %>
    </code>
    <p></p>
  </div>
  
  <% unless @product_links_by_rel_name.empty? %>
  <div class="info_snippet">
    <a name="related_products"> </a>
    <h2>Related Products</h2>
    <% @product_links_by_rel_name.each do |name, links| %>
    <p>This <%= name.tr("_", " ") %>...</p>
    <div class="related_set"> <%= links.join(" ") %> </div>
    <% end %>
  </div>  
  <% end %>
</div>

<div id="basket_panel">
  <p>basket in this column</p>
</div>

<script type="text/javascript" charset="utf-8">
  product_links_wire_up(<%= @rel_product_ids.to_json %>);
  product_thumb_hover({target: $('#product img.thumb')[0]});
</script>
